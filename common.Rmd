---
title: "common"
author: "linhnm"
date: '2022-05-17'
output: html_document
---

```{r setup, include=FALSE}
library(PASWR)
library(memisc)
library(GLMsData)
```

## Chapter 10

### Problem 17

An experiment \[23, 36\] recorded the time to failure of a piece of electronic equipment while operating in two diﬀerent modes. In any session, the machine is run in both modes for varying amounts of time (Table 10.20; dataset: failures). For each operating period, Mode 1 is the time spent operating in one mode and Mode 2 is the time spent operating in the other mode. The number of failures in each period is recorded, where each operating period is measured in weeks. The interest is in ﬁnding a model for the number of failures given the amount of time the equipment spends in the two modes.

Table 10.20 Observations on electronic equipment failures. The time spent in each mode is measured in weeks (Problem 10.17)

```{r echo=FALSE}
data(failures)
failures
```

1.  Plot the number of failures against the time spent in Mode 1, and then against the time spent in Mode 2.
2.  Show that an identity link function may be appropriate.
3.  Fit the Poisson model, to model the number of failures as a function of the time spent in the two modes. Which mode appears to be the major source of failures?
4.  Is there evidence of under- or overdispersion?
5.  Interpret the ﬁnal model.

**Solution:**

**1.**

```{r}
plot(Failures ~ Time1, data=failures, xlab="Time spent in Mode 1", ylab="Number of failures")
```

Từ biểu đồ ta có thể thấy mối quan hệ giữa Số lần trục trặc và thời gian hoạt động ở chế độ 1 là xấp xỉ tuyến tính.

```{r}
par(mfrow=c(1,2))
plot(Failures ~ Time2, data=failures,xlab="Time spent in Mode 2",ylab="Number of failures")
plot(log(Failures) ~ log(Time2), data=failures,xlab="log(Time spent in Mode 2)",ylab="Number of failures")
```

Biểu đồ chỉ ra xu hướng tương đối tuyến tính giữa số lần trục trặc và log của thời gian hoạt động ở chế độ 2.

**2.**

Ta thử thử fit một mô hình hồi quy tuyến tính (link function là identity)

```{r}
fitted.identity <- lm(Failures ~ Time1 + log(Time2), data=failures)
printCoefmat( coef( summary(fitted.identity)))
```

Giá trị kiểm định các hệ số cho thấy một mô hình hồi quy tuyến tính là tương đối phù hợp

**3.**

```{r}
fitted.poisson <- glm(Failures ~ Time1 + log(Time2), data=failures, family=poisson(link="log"))
printCoefmat( coef( summary(fitted.poisson)))
```

Từ bảng ANOVA, ta thấy rằng hiệu ứng của Thời gian hoạt động ở chế độ 1 là đáng kể tới tần suất hỏng của thiết bị, trong khi hiệu ứng của Thời gian hoạt động ở chế độ 2 là không đáng kể.

**4.**

```{r}
deviance(fitted.poisson)
df.residual(fitted.poisson)
```

Từ dữ liệu ta thấy độ chệch phần dự nhỏ hơn bậc tự do phần dư , nên mô hình có hiện tượng underdispersion

**5.**

Mô hình Poisson GLM có hiện tương underdispersion, vậy nên ta tìm kiếm một mô hình thay thế là quasi-Poisson. Vì Mode 2 không có ý nghĩa thống kê nên ta cũng loại khỏi mô hình

```{r}
m.qp <- glm(Failures ~ Time1, data=failures, family=quasipoisson)
printCoefmat( coef( summary(m.qp)))
```

*Tiến hành chuẩn đoán mô hình:*
Kiểm tra phần dư GLM 

```{r}
plot( resid(m.qp) ~ sqrt(fitted(m.qp)), las=1, main="Deviance residuals", ylab="Deviance residuals",xlab="Square root of fitted values" )
```

Kiểm tra sự phù hợp của việc lựa chọn Poisson GLM

=> 
Kiểm tra ảnh hưởng của các quan sát 
```{r}
plot( cooks.distance(m.qp), type="h", las=1,ylab="Cook's distance, D", main="Cook's distance")
```

Kiểm tra Possion EDM có phù hợp với biến đầu ra không 
```{r}
qqnorm( resid(m.qp), las=1,main="Normal Q-Q plot\ndeviance residuals")
qqline( resid(m.qp))
```
=> Từ biểu đồ có thể thấy rằng  các phân vị của mẫu bám sát đường phân vị lý thuyết nên mô hình Poisson là phù hợp 

### Problem 18

A report on Canadian cancer statistics estimated the number of deaths from various types of cancer in Canada in 2000 \[7\]. The ﬁve leading cancer sites are studied here (Table 10.21; data set: ccancer).

1.  Plot the cancer rates per thousand of population against each geographical location, and then against gender. Comment on the relationships.
2.  Identify the zeros as systematic or sampling.
3.  Find an appropriate model for the data using an appropriate oﬀset. Do the cancer rates appear to diﬀer across the geographic regions?
4.  Interpret the ﬁtted model.

Table 10.21 The estimated number of deaths for the ﬁve leading cancer sites in Canada in 2000, by geographic region and gender (Problem 10.18)

```{r}
data("ccancer")
ccancer
```

**1.**

